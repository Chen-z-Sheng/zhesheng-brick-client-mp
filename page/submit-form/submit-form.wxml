<!--page/submit-form/submit-form.wxml-->
<view class="container">
  <view class="header">
    <text class="title">{{formType === 'market' ? '行情报单' : '普通方案报单'}}</text>
  </view>
  
  <!-- 普通方案报单表单 -->
  <block wx:if="{{formType === 'normal'}}">
    <view class="form-section">
      <view class="form-item">
        <text class="label">选择方案</text>
        <view class="combined-input-select">
          <input class="input-with-select" placeholder="输入方案名称" bindinput="onPlanSearchInput" value="{{planSearchText}}"/>
          <view class="select-arrow" bindtap="togglePlanDropdown">
            <text class="dropdown-icon">▼</text>
          </view>
        </view>
        <view class="dropdown-list" wx:if="{{showPlanDropdown}}">
          <view class="dropdown-item {{planIndex === index ? 'active' : ''}}" 
                wx:for="{{filteredPlanList}}" 
                wx:key="id" 
                bindtap="selectPlan" 
                data-index="{{index}}">
            {{item.name}}
          </view>
          <view class="dropdown-empty" wx:if="{{filteredPlanList.length === 0}}">
            没有找到匹配的方案
          </view>
        </view>
      </view>
      
      <!-- 方案1的字段 -->
      <block wx:if="{{currentPlan.id === 1}}">
        <view class="form-item">
          <text class="label">下单地址</text>
          <input class="input" value="{{formData.address}}" disabled="true" placeholder="下单地址"/>
        </view>
        
        <view class="form-item">
          <text class="label">订单编号</text>
          <input class="input" value="{{formData.orderNumber}}" bindinput="onInputChange" data-field="orderNumber" placeholder="请输入订单编号"/>
        </view>
        
        <view class="form-item">
          <text class="label">快递单号</text>
          <input class="input" value="{{formData.expressNumber}}" bindinput="onInputChange" data-field="expressNumber" placeholder="请输入快递单号"/>
        </view>
        
        <view class="form-item">
          <text class="label">订单截图</text>
          <view class="upload-box" bindtap="chooseImage">
            <image wx:if="{{formData.orderImage}}" class="uploaded-image" src="{{formData.orderImage}}" mode="aspectFill"></image>
            <view wx:else class="upload-placeholder">
              <text class="upload-icon">+</text>
              <text class="upload-text">上传图片</text>
            </view>
          </view>
        </view>
        
        <view class="form-item">
          <text class="label">下单数量</text>
          <input class="input" type="number" value="{{formData.quantity}}" bindinput="onInputChange" data-field="quantity" placeholder="请输入下单数量"/>
        </view>
        
        <view class="form-item">
          <text class="label">预计回款</text>
          <input class="input" value="{{formData.expectedReturn}}" disabled="true" placeholder="预计回款金额"/>
        </view>
      </block>
      
      <!-- 方案2的字段 -->
      <block wx:elif="{{currentPlan.id === 2}}">
        <view class="form-item">
          <text class="label">下单数量</text>
          <input class="input" type="number" value="{{formData.quantity}}" bindinput="onInputChange" data-field="quantity" placeholder="请输入下单数量"/>
        </view>
        
        <view class="form-item">
          <text class="label">快递单号</text>
          <input class="input" value="{{formData.expressNumber}}" bindinput="onInputChange" data-field="expressNumber" placeholder="请输入快递单号"/>
        </view>
      </block>
    </view>
  </block>
  
  <!-- 行情报单表单 -->
  <block wx:elif="{{formType === 'market'}}">
    <view class="form-section">
      <view class="form-item">
        <text class="label">选择商品</text>
        <view class="product-selector">
          <view wx:for="{{productList}}" wx:key="id" class="product-item {{item.selected ? 'selected' : ''}}" bindtap="toggleProductSelection" data-id="{{item.id}}">
            <text class="product-name">{{item.name}}</text>
            <text class="product-price">¥{{item.price}}</text>
          </view>
        </view>
      </view>
      
      <!-- 已选商品列表 -->
      <view class="selected-products" wx:if="{{selectedProducts.length > 0}}">
        <text class="section-title">已选商品</text>
        <view wx:for="{{selectedProducts}}" wx:key="id" class="selected-product-item">
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <text class="product-price">¥{{item.price}}</text>
          </view>
          <view class="quantity-control">
            <text class="quantity-btn" bindtap="decreaseQuantity" data-id="{{item.id}}">-</text>
            <input class="quantity-input" type="number" value="{{item.quantity}}" bindinput="onQuantityChange" data-id="{{item.id}}"/>
            <text class="quantity-btn" bindtap="increaseQuantity" data-id="{{item.id}}">+</text>
          </view>
        </view>
      </view>
      
      <view class="form-item">
        <text class="label">快递单号</text>
        <input class="input" value="{{formData.expressNumber}}" bindinput="onInputChange" data-field="expressNumber" placeholder="请输入快递单号"/>
      </view>
      
      <view class="form-item">
        <text class="label">备注</text>
        <textarea class="textarea" value="{{formData.remark}}" bindinput="onInputChange" data-field="remark" placeholder="请输入备注信息"/>
      </view>
      
      <view class="form-item">
        <text class="label">预计回款金额</text>
        <view class="expected-return">¥{{expectedReturn}}</view>
      </view>
    </view>
  </block>
  
  <!-- 提交按钮 -->
  <view class="form-footer">
    <button class="draft-btn" bindtap="saveDraft">保存草稿</button>
    <button class="submit-btn" bindtap="submitForm">提交报单</button>
  </view>
</view>